<?php
/**
 * we cant get the dipendency injector from controller during the construct
 * so we have the get it in here
 */
$di = $this->_controller->getDi();
?>
<div class="page-top-bottons d-flex justify-content-end">
	<?= $this->contentTopBottons->buttonsToHtml(); ?>
</div>

<div id="admin-grid-table" class="d-none">
	<div class="row">
		<div class="col-6">
			Active Filters: 
			<div class="clearfix" v-if="filters.filters && filters.filters.search_fields.length">
				<small class="float-start mb-0 me-3" v-for="search_field of filters.filters.search_fields">
					<span v-if="search_field.type == 'text'"><span class="text-muted" >{{search_field.label}}:</span> {{search_field.search_string}}</span>
					<span v-if="search_field.type == 'range'">
						<span class="text-muted">{{search_field.label}}:</span> 
						From <span v-if="search_field.from">{{search_field.from}}</span><span v-else>0</span>
						To <span v-if="search_field.to">{{search_field.to}}</span><span v-else>*</span>
					</span>
					<span class="c-pointer" v-on:click="removeFilter(search_field)"><i class="far fa-times-circle"></i></span>
				</small>
			</div>
		</div>	
		<div class="col-6">
			<div class="admin-grid-top-buttons text-end mb-3" v-if="columns">
				<button type="button" class="btn btn-outline-primary" v-on:click="showFiltersModal()">
					<i class="fa-solid fa-filter"></i> Filters
				</button>
			</div>

			<div class="pagination-container d-flex align-items-center justify-content-end mb-3" v-if="filters.filters">
				<div class="d-flex align-items-center">
					<div for="pagination-limits" class="pe-0 d-block w-fit-content me-2">Per Page</div>
					<select class="builder-form-field form-select w-fit-content" type="select" name="status" value="" v-model="filters.filters.limit" v-on:change="changeLimitPerPage()">
						<option v-for="limit in limits" v-bind:value="limit" >{{limit}}</option>
					</select>
				</div>
				<div class="ms-2">
					<ul class="pagination d-flex align-items-center justify-content-end mb-0">
						<li class="page-item" v-if="list_data.current_page > 1">
							<a class="page-link" href="javascript:void(0)" v-on:click="goToPrevPage()">
								<i class="fa-solid fa-angles-left"></i>
							</a>
						</li>
						<li class="page-item ms-2 me-2">Page <input class="text-center w-65-px" type="text" value="1" v-model="filters.filters.page" v-on:change="goToPage()"></li>
						<li class="page-item me-2">of {{list_data.total_page}}</li>
						<li class="page-item" v-if="list_data.total_page > list_data.current_page">
							<a class="page-link" href="javascript:void(0)" v-on:click="goToNextPage()">
								<i class="fa-solid fa-angles-right"></i>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>	
	</div>

	<table class="<?= $this->tableClass ?>">
		<thead class="table-dark" v-if="columns">
			<tr>
				<th scope="col" v-for="column in columns" v-on:click="setOrderBy(column)">
					{{column.label}}
					<div class="float-end" v-if="column.column_name == filters.filters.sort_order.order_by">
						<i class="fa-solid fa-arrow-down-long" v-if="filters.filters.sort_order.direction == 'asc'"></i>
						<i class="fa-solid fa-arrow-up-long" v-if="filters.filters.sort_order.direction == 'desc'"></i>
					</div>
				</th>
			</tr>
		</thead>
		<tbody v-if="list_data">
			<tr v-for="field in list_data.data">
				<td v-for="column in columns" v-html="field[column.column_name]"></td>
			</tr>
		</tbody>
	</table>

	<div class="pagination-container d-flex align-items-center justify-content-end" v-if="filters.filters">
		<div class="d-flex align-items-center">
			<div for="pagination-limits" class="pe-0 d-block w-fit-content me-2">Per Page</div>
			<select class="builder-form-field form-select w-fit-content" type="select" name="status" value="" v-model="filters.filters.limit" v-on:change="changeLimitPerPage()">
				<option v-for="limit in limits" v-bind:value="limit" >{{limit}}</option>
			</select>
		</div>
		<div class="ms-2">
			<ul class="pagination d-flex align-items-center justify-content-end mb-0">
				<li class="page-item" v-if="list_data.current_page > 1">
					<a class="page-link" href="javascript:void(0)" v-on:click="goToPrevPage()">
						<i class="fa-solid fa-angles-left"></i>
					</a>
				</li>
				<li class="page-item ms-2 me-2">Page <input class="text-center w-65-px" type="text" value="1" v-model="filters.filters.page" v-on:change="goToPage()"></li>
				<li class="page-item me-2">of {{list_data.total_page}}</li>
				<li class="page-item" v-if="list_data.total_page > list_data.current_page">
					<a class="page-link" href="javascript:void(0)" v-on:click="goToNextPage()">
						<i class="fa-solid fa-angles-right"></i>
					</a>
				</li>
			</ul>
		</div>
	</div>

	<!-- Modal -->
	<div class="modal fade" id="admin-grid-filters-modal" tabindex="-1" role="dialog" aria-labelledby="adminGridFiltersModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="adminGridFiltersModalLabel">Filters</h5>
					<button type="button" class="close btn" data-bs-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<v-template v-if="columns">
						<v-template v-for="column in columns">
							<v-template v-if="column.filter">
								<div class="form-group mb-3" v-if="column.filter.type == 'text'">
									<label v-bind:for="'admin-grid-filter-'+column.column_name">{{column.label}}</label>
									<input type="text" class="form-control" v-bind:id="'admin-grid-filter-'+column.column_name" v-on:keyup="updateFilter(column.filter.type, column, $event, '')" />
								</div>
								<div class="form-group mb-3 row" v-if="column.filter.type == 'range'">
									<div class="col-6">
										<label v-bind:for="'admin-grid-filter-'+column.column_name+'-from'">{{column.label}} From</label>
										<input type="text" class="form-control" v-bind:id="'admin-grid-filter-'+column.column_name+'-from'" v-on:keyup="updateFilter(column.filter.type, column, $event, 'from')" />
									</div>
									<div class="col-6">
										<label v-bind:for="'admin-grid-filter-'+column.column_name+'-to'">{{column.label}} To</label>
										<input type="text" class="form-control" v-bind:id="'admin-grid-filter-'+column.column_name+'-to'" v-on:keyup="updateFilter(column.filter.type, column, $event, 'to')" />
									</div>
								</div>
							</v-template>
						</v-template>
					</v-template>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary" v-on:click="applyFilter()">Apply Filter</button>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	require([
		'opoink/bmodule/js/admin/ui.components.grid.min'
	], function(grid){
		grid._data.setListingName('<?= $this->listingName ?>').getListing();
	});
</script>